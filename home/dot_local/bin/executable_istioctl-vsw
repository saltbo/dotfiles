#!/bin/bash
version=$1
BINDIR=~/.local/bin

# download if not exist
if [ ! -f "${BINDIR}/istioctl${version}" ]; then
    cd ${BINDIR} && curl -L https://istio.io/downloadIstio | ISTIO_VERSION=${version} sh -
    if [ -f "${BINDIR}/istioctl${version}" ]; then
        chmod 755 "${BINDIR}/istioctl${version}"
    fi
fi

# switch the version
if [ ! -f "${BINDIR}/istioctl${version}" ]; then
    echo "File \"${BINDIR}/istioctl${version}\" not exists"
    exit 0
fi

ln -sf "${BINDIR}/istioctl${version}" "${BINDIR}/istioctl"
${BINDIR}/istioctl completion zsh >~/.local/share/zsh-completions/_istioctl
